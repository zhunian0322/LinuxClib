

MAJOR_VERSION = 
MINOR_VERSION = 
VERSION = ${MAJOR_VERSION}.${MINOR_VERSION}
NET_A_LIB_C_TARGE = libnet.a

SAMPLE_TCP_CLIENT = tcpClient
SAMPLE_TCP_SERVER = tcpServer
SAMPLE_UDP_CLIENT = udpClient
SAMPLE_UDP_SERVER = udpServer
SAMPLE_UDP_BROADCAST = udpBroadcast
SAMPLE_MQTT_CLIENT = mqttClient

SAMPLE_DIR = example
SAMPLE_SOURCES_TCP_CLIENT = ${SAMPLE_DIR}/${SAMPLE_TCP_CLIENT}.c
SAMPLE_SOURCES_TCP_SERVER = ${SAMPLE_DIR}/${SAMPLE_TCP_SERVER}.c
SAMPLE_SOURCES_UDP_CLIENT = ${SAMPLE_DIR}/${SAMPLE_UDP_CLIENT}.c
SAMPLE_SOURCES_UDP_SERVER = ${SAMPLE_DIR}/${SAMPLE_UDP_SERVER}.c
SAMPLE_SOURCES_UDP_BROADCAST = ${SAMPLE_DIR}/${SAMPLE_UDP_BROADCAST}.c
SAMPLE_SOURCES_MQTT_CLIENT = ${SAMPLE_DIR}/${SAMPLE_MQTT_CLIENT}.c



LIB_SOURCES = $(wildcard src/*.c)
LIB_OBJS = $(patsubst %.c,%.o,${LIB_SOURCES})

INCLUDES = inc

LIBS = 
CC = gcc
CXX = g++
AR = ar
CFLAGS = -g -Wall -std=gnu99 -static -I${INCLUDES}


all:${NET_A_LIB_C_TARGE} \
	${SAMPLE_TCP_CLIENT} \
	${SAMPLE_TCP_SERVER} \
	${SAMPLE_UDP_CLIENT} \
	${SAMPLE_UDP_SERVER} \
	${SAMPLE_UDP_BROADCAST} \
	${SAMPLE_MQTT_CLIENT}

${NET_A_LIB_C_TARGE}:${LIB_OBJS}
	${AR} cru ${NET_A_LIB_C_TARGE} ${LIB_OBJS}
	test -d lib || mkdir lib
	mv ${NET_A_LIB_C_TARGE} lib/${NET_A_LIB_C_TARGE}
	
${LIB_OBJS}:${LIB_SOURCES}
	${CC} -c ${CFLAGS} $*.c -o $@ ${LIBS}
	
${SAMPLE_TCP_CLIENT}:
	${CC} -c ${CFLAGS} ${SAMPLE_SOURCES_TCP_CLIENT} ${LIBS}
	${CC} ${SAMPLE_TCP_CLIENT}.o -o ${SAMPLE_TCP_CLIENT} -L lib -lnet
	test -d ${SAMPLE_DIR}/bin || mkdir ${SAMPLE_DIR}/bin
	mv ${SAMPLE_TCP_CLIENT} ${SAMPLE_DIR}/bin
	
${SAMPLE_TCP_SERVER}:
	${CC} -c ${CFLAGS} ${SAMPLE_SOURCES_TCP_SERVER} ${LIBS}
	${CC} ${SAMPLE_TCP_SERVER}.o -o ${SAMPLE_TCP_SERVER} -L lib -lnet
	test -d ${SAMPLE_DIR}/bin || mkdir ${SAMPLE_DIR}/bin
	mv ${SAMPLE_TCP_SERVER} ${SAMPLE_DIR}/bin
	

${SAMPLE_UDP_CLIENT}: 
	${CC} -c ${CFLAGS} ${SAMPLE_SOURCES_UDP_CLIENT} ${LIBS}
	${CC} ${SAMPLE_UDP_CLIENT}.o -o ${SAMPLE_UDP_CLIENT} -L lib -lnet
	test -d ${SAMPLE_DIR}/bin || mkdir ${SAMPLE_DIR}/bin
	mv ${SAMPLE_UDP_CLIENT} ${SAMPLE_DIR}/bin

${SAMPLE_UDP_SERVER}: 
	${CC} -c ${CFLAGS} ${SAMPLE_SOURCES_UDP_SERVER} ${LIBS}
	${CC} ${SAMPLE_UDP_SERVER}.o -o ${SAMPLE_UDP_SERVER} -L lib -lnet
	test -d ${SAMPLE_DIR}/bin || mkdir ${SAMPLE_DIR}/bin
	mv ${SAMPLE_UDP_SERVER} ${SAMPLE_DIR}/bin

${SAMPLE_UDP_BROADCAST}:
	${CC} -c ${CFLAGS} ${SAMPLE_SOURCES_UDP_BROADCAST} ${LIBS}
	${CC} ${SAMPLE_UDP_BROADCAST}.o -o ${SAMPLE_UDP_BROADCAST} -L lib -lnet
	test -d ${SAMPLE_DIR}/bin || mkdir ${SAMPLE_DIR}/bin
	mv ${SAMPLE_UDP_BROADCAST} ${SAMPLE_DIR}/bin

${SAMPLE_MQTT_CLIENT}:
	${CC} -c ${CFLAGS} ${SAMPLE_SOURCES_MQTT_CLIENT} -lpaho-mqtt3a
	${CC} ${SAMPLE_MQTT_CLIENT}.o -o ${SAMPLE_MQTT_CLIENT} -L lib -lnet -lpaho-mqtt3a
	test -d ${SAMPLE_DIR}/bin || mkdir ${SAMPLE_DIR}/bin
	mv ${SAMPLE_MQTT_CLIENT} ${SAMPLE_DIR}/bin


clean:
	rm -rf lib \
			src/*.o \
			*.o \
			*. ${SAMPLE_DIR}/bin
